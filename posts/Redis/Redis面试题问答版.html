<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.67" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://example.com/posts/Redis/Redis%E9%9D%A2%E8%AF%95%E9%A2%98%E9%97%AE%E7%AD%94%E7%89%88.html"><meta property="og:site_name" content="TOMMY"><meta property="og:title" content="Redis相关面试题"><meta property="og:description" content="Redis相关面试题 面试官：我看你做的项目中，都用到了Redis，你在最近的项目中那些场景用了Redis？ 候选人： xxx 面试官：什么是缓存穿透 ? 怎么解决 ? 候选人： 缓存穿透是指查询一个一定不存在的数据，如果从存储层查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到 DB 去查询，可能导致 DB 挂掉。这种情况大概率是遭到了攻击。"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-12-02T13:34:31.000Z"><meta property="article:author" content="tommy"><meta property="article:modified_time" content="2023-12-02T13:34:31.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redis相关面试题","image":[""],"dateModified":"2023-12-02T13:34:31.000Z","author":[{"@type":"Person","name":"tommy","url":"https://example.com"}]}</script><title>Redis相关面试题 | TOMMY</title><meta name="description" content="Redis相关面试题 面试官：我看你做的项目中，都用到了Redis，你在最近的项目中那些场景用了Redis？ 候选人： xxx 面试官：什么是缓存穿透 ? 怎么解决 ? 候选人： 缓存穿透是指查询一个一定不存在的数据，如果从存储层查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到 DB 去查询，可能导致 DB 挂掉。这种情况大概率是遭到了攻击。">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-7ee309fe.css" as="style"><link rel="stylesheet" href="/assets/style-7ee309fe.css">
    <link rel="modulepreload" href="/assets/app-7443d472.js"><link rel="modulepreload" href="/assets/Redis面试题问答版.html-4aa088f6.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="modulepreload" href="/assets/Redis面试题问答版.html-549da5b5.js"><link rel="prefetch" href="/assets/index.html-40cb32c6.js" as="script"><link rel="prefetch" href="/assets/intro.html-2636bcca.js" as="script"><link rel="prefetch" href="/assets/slides.html-e82e73b8.js" as="script"><link rel="prefetch" href="/assets/index.html-41f6e1d1.js" as="script"><link rel="prefetch" href="/assets/disable.html-cbf100c1.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-055030e8.js" as="script"><link rel="prefetch" href="/assets/markdown.html-c2120d69.js" as="script"><link rel="prefetch" href="/assets/page.html-7b6f07fa.js" as="script"><link rel="prefetch" href="/assets/cherry.html-454eed94.js" as="script"><link rel="prefetch" href="/assets/dragonfruit.html-1209ce6d.js" as="script"><link rel="prefetch" href="/assets/strawberry.html-d415afec.js" as="script"><link rel="prefetch" href="/assets/tomato.html-93e00375.js" as="script"><link rel="prefetch" href="/assets/1.html-e8a058d9.js" as="script"><link rel="prefetch" href="/assets/2.html-b420b84b.js" as="script"><link rel="prefetch" href="/assets/3.html-645defb1.js" as="script"><link rel="prefetch" href="/assets/4.html-c2b92485.js" as="script"><link rel="prefetch" href="/assets/Redis分布式锁.html-a27cc664.js" as="script"><link rel="prefetch" href="/assets/1.html-694f5ce7.js" as="script"><link rel="prefetch" href="/assets/2.html-9543c89f.js" as="script"><link rel="prefetch" href="/assets/3.html-eb9cc2f9.js" as="script"><link rel="prefetch" href="/assets/4.html-a869d6b3.js" as="script"><link rel="prefetch" href="/assets/工作计划.html-0ac8e9ce.js" as="script"><link rel="prefetch" href="/assets/404.html-eeee1f23.js" as="script"><link rel="prefetch" href="/assets/index.html-e8ce9240.js" as="script"><link rel="prefetch" href="/assets/index.html-00352625.js" as="script"><link rel="prefetch" href="/assets/index.html-56fd883f.js" as="script"><link rel="prefetch" href="/assets/index.html-f2e9705a.js" as="script"><link rel="prefetch" href="/assets/index.html-976d0126.js" as="script"><link rel="prefetch" href="/assets/index.html-9a269823.js" as="script"><link rel="prefetch" href="/assets/index.html-e861b919.js" as="script"><link rel="prefetch" href="/assets/index.html-d30d7173.js" as="script"><link rel="prefetch" href="/assets/index.html-a93794ca.js" as="script"><link rel="prefetch" href="/assets/index.html-90cb1a11.js" as="script"><link rel="prefetch" href="/assets/index.html-90ab3e87.js" as="script"><link rel="prefetch" href="/assets/index.html-fb8fe616.js" as="script"><link rel="prefetch" href="/assets/index.html-51b0ad97.js" as="script"><link rel="prefetch" href="/assets/index.html-b243b7aa.js" as="script"><link rel="prefetch" href="/assets/index.html-bfa9e5f3.js" as="script"><link rel="prefetch" href="/assets/index.html-8792e088.js" as="script"><link rel="prefetch" href="/assets/index.html-4914d935.js" as="script"><link rel="prefetch" href="/assets/index.html-64b0d6d8.js" as="script"><link rel="prefetch" href="/assets/index.html-8a45d858.js" as="script"><link rel="prefetch" href="/assets/index.html-405ddeb0.js" as="script"><link rel="prefetch" href="/assets/index.html-9a8889b6.js" as="script"><link rel="prefetch" href="/assets/index.html-dc280eed.js" as="script"><link rel="prefetch" href="/assets/index.html-d1c3c76c.js" as="script"><link rel="prefetch" href="/assets/index.html-e8394810.js" as="script"><link rel="prefetch" href="/assets/index.html-73aa794d.js" as="script"><link rel="prefetch" href="/assets/index.html-9806aa57.js" as="script"><link rel="prefetch" href="/assets/index.html-3ecdde71.js" as="script"><link rel="prefetch" href="/assets/index.html-541ed0f2.js" as="script"><link rel="prefetch" href="/assets/index.html-404b61ee.js" as="script"><link rel="prefetch" href="/assets/index.html-7b14d228.js" as="script"><link rel="prefetch" href="/assets/index.html-eac70762.js" as="script"><link rel="prefetch" href="/assets/index.html-e9788498.js" as="script"><link rel="prefetch" href="/assets/index.html-e0a0450a.js" as="script"><link rel="prefetch" href="/assets/index.html-b45c5071.js" as="script"><link rel="prefetch" href="/assets/intro.html-5538704d.js" as="script"><link rel="prefetch" href="/assets/slides.html-39750435.js" as="script"><link rel="prefetch" href="/assets/index.html-85b2a682.js" as="script"><link rel="prefetch" href="/assets/disable.html-d6c34eb9.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-3e3768f4.js" as="script"><link rel="prefetch" href="/assets/markdown.html-0d00d931.js" as="script"><link rel="prefetch" href="/assets/page.html-2c1785d2.js" as="script"><link rel="prefetch" href="/assets/cherry.html-59611493.js" as="script"><link rel="prefetch" href="/assets/dragonfruit.html-b7304e9a.js" as="script"><link rel="prefetch" href="/assets/strawberry.html-3276a69b.js" as="script"><link rel="prefetch" href="/assets/tomato.html-0309ce3e.js" as="script"><link rel="prefetch" href="/assets/1.html-d1cb097b.js" as="script"><link rel="prefetch" href="/assets/2.html-d2d54e3e.js" as="script"><link rel="prefetch" href="/assets/3.html-d7c49bc8.js" as="script"><link rel="prefetch" href="/assets/4.html-def0b147.js" as="script"><link rel="prefetch" href="/assets/Redis分布式锁.html-20e4efff.js" as="script"><link rel="prefetch" href="/assets/1.html-a1f61f43.js" as="script"><link rel="prefetch" href="/assets/2.html-0eaf6a89.js" as="script"><link rel="prefetch" href="/assets/3.html-b0274606.js" as="script"><link rel="prefetch" href="/assets/4.html-f756555d.js" as="script"><link rel="prefetch" href="/assets/工作计划.html-abb9753b.js" as="script"><link rel="prefetch" href="/assets/404.html-79766df9.js" as="script"><link rel="prefetch" href="/assets/index.html-235ce845.js" as="script"><link rel="prefetch" href="/assets/index.html-2f34c13f.js" as="script"><link rel="prefetch" href="/assets/index.html-8d4045cc.js" as="script"><link rel="prefetch" href="/assets/index.html-0f7eab74.js" as="script"><link rel="prefetch" href="/assets/index.html-6de8aa4e.js" as="script"><link rel="prefetch" href="/assets/index.html-0b63bce4.js" as="script"><link rel="prefetch" href="/assets/index.html-31ede988.js" as="script"><link rel="prefetch" href="/assets/index.html-143b9811.js" as="script"><link rel="prefetch" href="/assets/index.html-9554ec4e.js" as="script"><link rel="prefetch" href="/assets/index.html-4005c256.js" as="script"><link rel="prefetch" href="/assets/index.html-6a42f4b6.js" as="script"><link rel="prefetch" href="/assets/index.html-2f628833.js" as="script"><link rel="prefetch" href="/assets/index.html-4bf39c45.js" as="script"><link rel="prefetch" href="/assets/index.html-46ca52fa.js" as="script"><link rel="prefetch" href="/assets/index.html-b9ec4968.js" as="script"><link rel="prefetch" href="/assets/index.html-f414ac2c.js" as="script"><link rel="prefetch" href="/assets/index.html-848b46e7.js" as="script"><link rel="prefetch" href="/assets/index.html-d4bf901e.js" as="script"><link rel="prefetch" href="/assets/index.html-32a089c0.js" as="script"><link rel="prefetch" href="/assets/index.html-62923214.js" as="script"><link rel="prefetch" href="/assets/index.html-ef349ecf.js" as="script"><link rel="prefetch" href="/assets/index.html-074b5e54.js" as="script"><link rel="prefetch" href="/assets/index.html-11e292ba.js" as="script"><link rel="prefetch" href="/assets/index.html-5fd14608.js" as="script"><link rel="prefetch" href="/assets/index.html-859bca31.js" as="script"><link rel="prefetch" href="/assets/index.html-be4be844.js" as="script"><link rel="prefetch" href="/assets/index.html-6c5717b2.js" as="script"><link rel="prefetch" href="/assets/index.html-b219d28e.js" as="script"><link rel="prefetch" href="/assets/index.html-b82b1dd4.js" as="script"><link rel="prefetch" href="/assets/index.html-82b22a16.js" as="script"><link rel="prefetch" href="/assets/index.html-65e39736.js" as="script"><link rel="prefetch" href="/assets/index.html-acce71ba.js" as="script"><link rel="prefetch" href="/assets/index.html-67be9cde.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-1464cdb9.js" as="script"><link rel="prefetch" href="/assets/pageview-020598fa.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt="TOMMY"><!----><span class="vp-site-name hide-in-pad">TOMMY</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="博客主页" class="vp-link nav-link nav-link" href="/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>博客主页<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="intro" class="vp-link nav-link nav-link" href="/intro.html"><!---->intro<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="博文"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>博文</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>苹果</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="苹果1" class="vp-link nav-link nav-link" href="/posts/apple/1.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>苹果1<!----></a></li><li class="dropdown-subitem"><a aria-label="苹果2" class="vp-link nav-link nav-link" href="/posts/apple/2.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>苹果2<!----></a></li><li class="dropdown-subitem"><a aria-label="苹果 3" class="vp-link nav-link nav-link" href="/posts/apple/3.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>苹果 3<!----></a></li><li class="dropdown-subitem"><a aria-label="苹果 4" class="vp-link nav-link nav-link" href="/posts/apple/4.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>苹果 4<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>香蕉</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a aria-label="香蕉 1" class="vp-link nav-link nav-link" href="/posts/banana/1.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>香蕉 1<!----></a></li><li class="dropdown-subitem"><a aria-label="香蕉 2" class="vp-link nav-link nav-link" href="/posts/banana/2.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>香蕉 2<!----></a></li><li class="dropdown-subitem"><a aria-label="香蕉 3" class="vp-link nav-link nav-link" href="/posts/banana/3.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>香蕉 3<!----></a></li><li class="dropdown-subitem"><a aria-label="香蕉 4" class="vp-link nav-link nav-link" href="/posts/banana/4.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>香蕉 4<!----></a></li></ul></li><li class="dropdown-item"><a aria-label="樱桃" class="vp-link nav-link nav-link" href="/posts/cherry.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>樱桃<!----></a></li><li class="dropdown-item"><a aria-label="火龙果" class="vp-link nav-link nav-link" href="/posts/dragonfruit.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>火龙果<!----></a></li><li class="dropdown-item"><a aria-label="番茄" class="vp-link nav-link nav-link" href="/posts/tomato.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>番茄<!----></a></li><li class="dropdown-item"><a aria-label="草莓" class="vp-link nav-link nav-link" href="/posts/strawberry.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>草莓<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://theme-hope.vuejs.press/zh/" rel="noopener noreferrer" target="_blank" aria-label="V2 文档" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>V2 文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="https://theme-hope.vuejs.press/zh/" rel="noopener noreferrer" target="_blank" aria-label="V3 文档" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>V3 文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><!----><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><!--[--><a aria-label="博客主页" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>博客主页<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading clickable"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a aria-label="如何使用" class="vp-link nav-link vp-sidebar-title nav-link vp-sidebar-title" href="/demo/"><!---->如何使用<!----></a><!----></p><ul class="vp-sidebar-links"><li><!--[--><a aria-label="页面配置" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/demo/page.html"><span class="font-icon icon fa-fw fa-sm fas fa-file" style=""></span>页面配置<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Markdown 展示" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/demo/markdown.html"><span class="font-icon icon fa-fw fa-sm fab fa-markdown" style=""></span>Markdown 展示<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="布局与功能禁用" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/demo/disable.html"><span class="font-icon icon fa-fw fa-sm fas fa-gears" style=""></span>布局与功能禁用<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="密码加密的文章" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/demo/encrypt.html"><span class="font-icon icon fa-fw fa-sm fas fa-lock" style=""></span>密码加密的文章<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading active"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">文章</span><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Apple</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Banana</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a aria-label="Redis分布式锁" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/Redis/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>Redis分布式锁<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="Redis相关面试题" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/posts/Redis/Redis%E9%9D%A2%E8%AF%95%E9%A2%98%E9%97%AE%E7%AD%94%E7%89%88.html"><!---->Redis相关面试题<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a aria-label="樱桃" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/cherry.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>樱桃<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="火龙果" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/dragonfruit.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>火龙果<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="番茄" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/tomato.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>番茄<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-label="草莓" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/strawberry.html"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>草莓<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">随笔</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><!--[--><a aria-label="About Me" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/intro.html"><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>About Me<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Redis相关面试题</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://example.com" target="_blank" rel="noopener noreferrer">tommy</a></span><span property="author" content="tommy"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-12-02T13:34:31.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 21 分钟</span><meta property="timeRequired" content="PT21M"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category3 clickable" role="navigation">Redis</span><span class="page-category-item category8 clickable" role="navigation">面试题</span><!--]--><meta property="articleSection" content="Redis,面试题"></span><!----></div><hr></div><!----><!----><div class="theme-hope-content"><h1 id="redis相关面试题" tabindex="-1"><a class="header-anchor" href="#redis相关面试题" aria-hidden="true">#</a> Redis相关面试题</h1><p><strong>面试官</strong>：我看你做的项目中，都用到了Redis，你在最近的项目中那些场景用了Redis？</p><p><strong>候选人</strong>：</p><p>xxx</p><hr><p><strong>面试官</strong>：什么是缓存穿透 ? 怎么解决 ?</p><p><strong>候选人</strong>：</p><p>缓存穿透是指查询一个一定<strong>不存在</strong>的数据，如果从存储层查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到 DB 去查询，可能导致 DB 挂掉。这种情况大概率是遭到了攻击。</p><p>解决方案的话，我们通常都会用布隆过滤器来解决它</p><hr><p><strong>面试官</strong>：好的，你能介绍一下布隆过滤器吗？</p><p><strong>候选人</strong>：</p><p>嗯，是这样~</p><p>布隆过滤器主要是用于检索一个元素是否在一个集合中。我们当时使用的是redisson实现的布隆过滤器。</p><p>它的底层主要是先去初始化一个比较大数组，里面存放的二进制0或1。在一开始都是0，当一个key来了之后经过3次hash计算，模于数组长度找到数据的下标然后把数组中原来的0改为1，这样的话，三个数组的位置就能标明一个key的存在。查找的过程也是一样的。</p><p>当然是有缺点的，布隆过滤器有可能会产生一定的误判，我们一般可以设置这个误判率，大概不会超过5%，其实这个误判是必然存在的，要不就得增加数组的长度，其实已经算是很划分了，5%以内的误判率一般的项目也能接受，不至于高并发下压倒数据库。</p><hr><p><strong>面试官</strong>：什么是缓存击穿 ? 怎么解决 ?</p><p><strong>候选人</strong>：</p><p>嗯！！</p><p>缓存击穿的意思是对于设置了过期时间的key，缓存在某个时间点过期的时候，恰好这时间点对这个Key有大量的并发请求过来，这些请求发现缓存过期一般都会从后端 DB 加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把 DB 压垮。</p><p>解决方案有三种方式：</p><p>第一对于高热点数据，永远不设置过期时间</p><p>第二可以使用分布式锁：当缓存失效时，不立即去load db，先使用如 Redis 的 setnx 去设置一个互斥锁，当操作成功返回时再进行 load db的操作并回设缓存，否则重试get缓存的方法</p><p>第三种方案可以设置当前key逻辑过期，大概是思路如下：</p><p>①：在设置key的时候，设置一个过期时间字段一块存入缓存中，不给当前key设置过期时间</p><p name:sss,age:12,expire:12312344="">例如：</p><p>②：当查询的时候，从redis取出数据后判断时间是否过期</p><p>③：如果过期则开通另外一个线程进行数据同步，当前线程正常返回数据，返回的数据时过期的数据</p><p>当然两种方案各有利弊：</p><p>如果选择数据的强一致性，建议使用分布式锁的方案，性能上可能没那么高，锁需要等，也有可能产生死锁的问题</p><p>如果选择key的逻辑删除，则优先考虑的高可用性，性能比较高，但是数据同步这块做不到强一致</p><p><strong>具体的业务场景选取二者之一即可，类似于转账场景需要强一致性，用户体验优先的情况下首先考虑高可用性。</strong></p><hr><p><strong>面试官</strong>：什么是缓存雪崩 ? 怎么解决 ?</p><p><strong>候选人</strong>：</p><p>缓存雪崩有两种导致的方式，第一种缓存雪崩意思是设置缓存时采用了相同的过期时间，导致缓存在某一时刻同时失效，请求全部转发到DB，DB 瞬时压力过重雪崩。第二种缓存雪崩是因为Redis集群挂掉导致的。</p><p>与缓存击穿的区别：雪崩是很多key，击穿是某一个key缓存。</p><ol><li>解决方案主要是可以将缓存失效时间分散开，比如可以在原有的失效时间基础上增加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件。</li><li>当由于Redis集群挂掉导致的缓存雪崩时，这种情况下可以通过搭建Redis集群来防止，如哨兵模式，集群模式。</li><li>穿透、击穿、雪崩问题都可以通过限流保底解决。</li></ol><hr><p><strong>面试官</strong>：redis做为缓存，mysql的数据如何与redis进行同步呢？（双写一致性）</p><blockquote><p>先介绍自己的业务背景，抛出这个饵。（一致性要求高、允许延迟一致是两种不同的解决方案，所以要针对于项目来说）</p><p>**双写一致性？**当修改了数据库的数据也要更新缓存的数据，缓存和数据库的数据要保持一致性</p><p>共享锁：读锁，加锁之后，其他线程可以共享读操作，但是不能写</p><p>排他锁：独占锁，加锁之后阻塞其他线程的读写操作</p></blockquote><p><strong>候选人</strong>：我最近做的这个项目xxx，里面有xxxx（<strong>根据自己的简历上写</strong>）的功能，需要让数据库与redis高度保持一致，因为要求时效性比较高，我们当时采用的读写锁保证的强一致性。</p><p>我们采用的是redisson实现的读写锁，在读的时候添加共享锁，可以保证读读不互斥，读写互斥。当我们更新数据的时候，添加排他锁，它是读写，读读都互斥，这样就能保证在写数据的同时是不会让其他线程读数据的，避免了脏数据。这里面需要注意的是<strong>读方法和写方法上需要使用同一把锁</strong>才行。</p><hr><p><strong>面试官</strong>：那这个排他锁是如何保证读写、读读互斥的呢？</p><p><strong>候选人</strong>：其实排他锁底层使用也是setnx，保证了同时只能有一个线程操作锁住的方法</p><hr><p><strong>面试官</strong>：你听说过延时双删吗？为什么不用它呢？</p><p><strong>候选人</strong>：延迟双删，两次删除缓存的操作。如果是写操作，我们先把缓存中的数据删除，然后更新数据库，最后再延时删除缓存中的数据，其中这个延时多久不太好确定，在延时的过程中可能会出现脏数据，并不能保证强一致性，所以没有采用它，延时只是尽可能的降低了脏数据的风险，而并不能完全排除脏数据。</p><hr><p><strong>面试官</strong>：redis做为缓存，mysql的数据如何与redis进行同步呢？（双写一致性）</p><figure><img src="https://tommy-blog-bucket.oss-cn-beijing.aliyuncs.com/blog/image-20231202203301736.png" alt="image-20231202203301736" tabindex="0" loading="lazy"><figcaption>image-20231202203301736</figcaption></figure><blockquote><p>Binlog：二进制日志，记录了所有的DDL语句和DML语句，但是不包括数据查询语句。</p></blockquote><p><strong>候选人</strong>：嗯！就说我最近做的这个项目，里面有xxxx（<strong>根据自己的简历上写</strong>）的功能，数据同步可以有一定的延时（符合大部分业务）</p><p>方法一：我们当时采用的阿里的<strong>canal</strong>组件实现数据同步，canal使用mysql的主从实现最终一致性：不需要更改业务代码，业务代码0侵入，部署一个canal服务。canal服务把自己伪装成mysql的一个从节点，当mysql数据更新以后，canal会读取binlog数据，然后在通过canal的客户端获取到数据，更新缓存即可。</p><p>方法二：可以使用<strong>异步通知</strong>的方式保证数据的最终一致性，主要依赖于MQ的可靠性。修改MySQL数据后，发送消息到MQ服务，其中缓存服务监听MQ，发现MySQL数据发生了更改就删除Redis中的这条数据的缓存</p><hr><p><strong>面试官</strong>：redis做为缓存，数据的持久化是怎么做的？</p><p><strong>候选人</strong>：在Redis中提供了两种数据持久化的方式：1、RDB 2、AOF</p><p>RDB的数据持久化策略：将内存数据保存在RDB二进制文件中，在恢复数据时直接将数据copy到内存中。其中对于RDB的数据持久化有两种备份方案：</p><ol><li><p>可以通过人工备份：<code>save</code>或者指令<code>bgsave</code>来生成Redis持久化文件。</p></li><li><p>可以使用自动触发策略备份，需要在RedisConfig配置文件中添加Save配置项。如下所示，在900秒内至少有一个key被修改，则执行bgsave。</p></li></ol><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>save <span class="token number">900</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>对于AOF的数据持久化策略：AOF是将每一次执行的写命令记录下来，在恢复数据时全部重新执行一遍。</p><p>AOF持久化策略默认时关闭的，需要在RedisConfig中将其配置开启：appendonly: yes；appendonly: &quot;appendonly.aof&quot;；分别指定开启AOF与指定AOF文件名称</p><p>AOF的刷盘策略？三种刷盘策略：1. 每执行一次写命令，立即记录到AOF文件中，对性能损耗过大；2.每秒执行一次刷盘策略，性能适中，最多丢失一秒数据；3. 写命令执行完先放到缓冲区中，等待操作系统的指示执行刷盘策略，性能很高但是容易丢失大量的数据。三种策略也同样在RedisConfig 文件中配置。</p><p>文件特点：AOF文件会比RDB文件大的多，而且AOF会记录对同一个KEy的多次写操作，但是只有最后一个写操作才是有效的；可以执行bgrewtiteof指令，让AOF文件执行重构，用最少的指令行达到相同的结果。也可以通过配置指定自动触发条件，例如配置：与上次AOF相比文件增长超过的百分比？AOF文件体积最小多大以上才出发重写？</p><hr><p><strong>面试官</strong>：RDB的执行原理是什么？</p><figure><img src="https://tommy-blog-bucket.oss-cn-beijing.aliyuncs.com/blog/image-20231202205116237.png" alt="image-20231202205116237" tabindex="0" loading="lazy"><figcaption>image-20231202205116237</figcaption></figure><p><strong>候选人</strong>：bgsave在开始时会fork主进程得到子进程，其中fork过程会阻塞，但是阻塞是nm级别的。此时子进程可共享主进程的内存数据，此时的copy过程直接将主进程的页表copy一份给子进程，这样速度就很快了，有了相同的页表，此时主进程和子进程二者拥有了相同的物理内存映射关系，子进程也可读到主进程相同的数据了，并写入RDB文件中（针对整个内存做快照）。</p><p>其他进程不会被阻塞，为了防止写rdb时其他进程过来读、修改内存数据导致脏数据的问题，fork底层采用copy-on-write技术，其中当主进程执行读操作时，访问共享内存；当主进程执行些操作时，会copy一份数据，执行写操作，并且会改变页表中指针指向的物理内存地址为copy后的地址。</p><hr><p><strong>面试官</strong>：这两种方式，哪种恢复的比较快呢？</p><p><strong>候选人</strong>：RDB因为是二进制文件，并且RDB文件会压缩，刷盘策略没有AOF那么频繁，所以在保存的时候体积也是比较小的，它恢复的比较快，但是它有可能会丢数据，我们通常在项目中也会使用AOF来恢复数据，虽然AOF恢复的速度慢一些，但是它丢数据的风险要小很多，在AOF文件中可以设置刷盘策略，我们当时设置的就是每秒批量写入一次命令</p><hr><p><strong>面试官</strong>：Redis的数据过期策略有哪些 ?</p><p><strong>候选人</strong>：</p><p>嗯~，在redis中提供了两种数据过期删除策略</p><p>第一种是惰性删除，在设置该key过期时间后，我们不去管它，当需要该key时，我们在检查其是否过期，如果过期，我们就删掉它，反之返回该key。</p><p>第二种是 定期删除，就是说每隔一段时间，我们就对一些key进行检查，删除里面过期的key</p><p>定期清理的两种模式：</p><ul><li>SLOW模式是定时任务，执行频率默认为10hz，每次不超过25ms，以通过修改配置文件redis.conf 的 <strong>hz</strong> 选项来调整这个次数</li><li>FAST模式执行频率不固定，每次事件循环会尝试执行，但两次间隔不低于2ms，每次耗时不超过1ms</li></ul><p>Redis的过期删除策略：<strong>惰性删除 + 定期删除</strong>两种策略进行配合使用。</p><hr><p><strong>面试官</strong>：Redis的数据淘汰策略有哪些 ?</p><p><strong>候选人</strong>：</p><p>嗯，这个在redis中提供了很多种，默认是noeviction，不删除任何数据，内部不足直接报错</p><p>是可以在redis的配置文件中进行设置的，里面有两个非常重要的概念，一个是LRU，另外一个是LFU</p><p>LRU的意思就是最少最近使用，用当前时间减去最后一次访问时间，这个值越大则淘汰优先级越高。</p><p>LFU的意思是最少频率使用。会统计每个key的访问频率，值越小淘汰优先级越高</p><p>我们在项目设置的allkeys-lru，挑选最近最少使用的数据淘汰，把一些经常访问的key留在redis中</p><hr><p><strong>面试官</strong>：数据库有1000万数据 ,Redis只能缓存20w数据, 如何保证Redis中的数据都是热点数据 ?</p><p><strong>候选人</strong>：</p><p>嗯，我想一下~~</p><p>可以使用 allkeys-lru （挑选最近最少使用的数据淘汰）淘汰策略，那留下来的都是经常访问的热点数据</p><hr><p><strong>面试官</strong>：Redis的内存用完了会发生什么？</p><p><strong>候选人</strong>：</p><p>嗯~，这个要看redis的数据淘汰策略是什么，如果是默认的配置，redis内存用完以后则直接报错。我们当时设置的 allkeys-lru 策略。把最近最常访问的数据留在缓存中。</p><hr><p><strong>面试官</strong>：Redis分布式锁如何实现 ?</p><p><strong>候选人</strong>：嗯，在redis中提供了一个命令setnx(SET if not exists)</p><p>由于redis的单线程的，用了命令之后，只能有一个客户端对某一个key设置值，在没有过期或删除key的时候是其他客户端是不能设置这个key的</p><hr><p><strong>面试官</strong>：好的，那你如何控制Redis实现分布式锁有效时长呢？</p><p><strong>候选人</strong>：嗯，的确，redis的setnx指令不好控制这个问题，我们当时采用的redis的一个框架redisson实现的。</p><p>在redisson中需要手动加锁，并且可以控制锁的失效时间和等待时间，当锁住的一个业务还没有执行完成的时候，在redisson中引入了一个看门狗机制，就是说每隔一段时间就检查当前业务是否还持有锁，如果持有就增加加锁的持有时间，当业务执行完成之后需要使用释放锁就可以了</p><p>还有一个好处就是，在高并发下，一个业务有可能会执行很快，先客户1持有锁的时候，客户2来了以后并不会马上拒绝，它会自旋不断尝试获取锁，如果客户1释放之后，客户2就可以马上持有锁，性能也得到了提升。</p><hr><p><strong>面试官</strong>：好的，redisson实现的分布式锁是可重入的吗？</p><p><strong>候选人</strong>：嗯，是可以重入的。这样做是为了避免死锁的产生。这个重入其实在内部就是判断是否是当前线程持有的锁，如果是当前线程持有的锁就会计数，如果释放锁就会在计算上减一。在存储数据的时候采用的hash结构，大key可以按照自己的业务进行定制，其中小key是当前线程的唯一标识，value是当前线程重入的次数</p><hr><p><strong>面试官</strong>：redisson实现的分布式锁能解决主从一致性的问题吗</p><p><strong>候选人</strong>：这个是不能的，比如，当线程1加锁成功后，master节点数据会异步复制到slave节点，此时当前持有Redis锁的master节点宕机，slave节点被提升为新的master节点，假如现在来了一个线程2，再次加锁，会在新的master节点上加锁成功，这个时候就会出现两个节点同时持有一把锁的问题。</p><p>我们可以利用redisson提供的红锁来解决这个问题，它的主要作用是，不能只在一个redis实例上创建锁，应该是在多个redis实例上创建锁，并且要求在大多数redis节点上都成功创建锁，红锁中要求是redis的节点数量要过半。这样就能避免线程1加锁成功后master节点宕机导致线程2成功加锁到新的master节点上的问题了。</p><p>但是，如果使用了红锁，因为需要同时在多个节点上都添加锁，性能就变的很低了，并且运维维护成本也非常高，所以，我们一般在项目中也不会直接使用红锁，并且官方也暂时废弃了这个红锁</p><hr><p><strong>面试官</strong>：好的，如果业务非要保证数据的强一致性，这个该怎么解决呢？</p><p>**候选人：**嗯~，redis本身就是支持高可用的，做到强一致性，就非常影响性能，所以，如果有强一致性要求高的业务，建议使用zookeeper实现的分布式锁，它是可以保证强一致性的。</p><hr><p><strong>面试官</strong>：Redis集群有哪些方案, 知道嘛 ?</p><p><strong>候选人</strong>：嗯~~，在Redis中提供的集群方案总共有三种：主从复制、哨兵模式、Redis分片集群</p><hr><p><strong>面试官</strong>：那你来介绍一下主从同步</p><p><strong>候选人</strong>：嗯，是这样的，单节点Redis的并发能力是有上限的，要进一步提高Redis的并发能力，可以搭建主从集群，实现读写分离。一般都是一主多从，主节点负责写数据，从节点负责读数据，主节点写入数据之后，需要把数据同步到从节点中</p><p><strong>面试官</strong>：能说一下，主从同步数据的流程</p><p><strong>候选人</strong>：嗯~~，好！主从同步分为了两个阶段，一个是全量同步，一个是增量同步</p><p>全量同步是指从节点第一次与主节点建立连接的时候使用全量同步，流程是这样的：</p><p>第一：从节点请求主节点同步数据，其中从节点会携带自己的replication id和offset偏移量。</p><p>第二：主节点判断是否是第一次请求，主要判断的依据就是，主节点与从节点是否是同一个replication id，如果不是，就说明是第一次同步，那主节点就会把自己的replication id和offset发送给从节点，让从节点与主节点的信息保持一致。</p><p>第三：在同时主节点会执行bgsave，生成rdb文件后，发送给从节点去执行，从节点先把自己的数据清空，然后执行主节点发送过来的rdb文件，这样就保持了一致</p><p>当然，如果在rdb生成执行期间，依然有请求到了主节点，而主节点会以命令的方式记录到缓冲区，缓冲区是一个日志文件，最后把这个日志文件发送给从节点，这样就能保证主节点与从节点完全一致了，后期再同步数据的时候，都是依赖于这个日志文件，这个就是全量同步</p><p>增量同步指的是，当从节点服务重启之后，数据就不一致了，所以这个时候，从节点会请求主节点同步数据，主节点还是判断不是第一次请求，不是第一次就获取从节点的offset值，然后主节点从命令日志中获取offset值之后的数据，发送给从节点进行数据同步</p><p><strong>面试官</strong>：怎么保证Redis的高并发高可用</p><p><strong>候选人</strong>：首先可以搭建主从集群，再加上使用redis中的哨兵模式，哨兵模式可以实现主从集群的自动故障恢复，里面就包含了对主从服务的监控、自动故障恢复、通知；如果master故障，Sentinel会将一个slave提升为master。当故障实例恢复后也以新的master为主；同时Sentinel也充当Redis客户端的服务发现来源，当集群发生故障转移时，会将最新信息推送给Redis的客户端，所以一般项目都会采用哨兵的模式来保证redis的高并发高可用</p><p><strong>面试官</strong>：你们使用redis是单点还是集群，哪种集群</p><p><strong>候选人</strong>：嗯！，我们当时使用的是主从（1主1从）加哨兵。一般单节点不超过10G内存，如果Redis内存不足则可以给不同服务分配独立的Redis主从节点。尽量不做分片集群。因为集群维护起来比较麻烦，并且集群之间的心跳检测和数据通信会消耗大量的网络带宽，也没有办法使用lua脚本和事务</p><p><strong>面试官</strong>：redis集群脑裂，该怎么解决呢？</p><p><strong>候选人</strong>：嗯！ 这个在项目很少见，不过脑裂的问题是这样的，我们现在用的是redis的哨兵模式集群的</p><p>有的时候由于网络等原因可能会出现脑裂的情况，就是说，由于redis master节点和redis salve节点和sentinel处于不同的网络分区，使得sentinel没有能够心跳感知到master，所以通过选举的方式提升了一个salve为master，这样就存在了两个master，就像大脑分裂了一样，这样会导致客户端还在old master那里写入数据，新节点无法同步数据，当网络恢复后，sentinel会将old master降为salve，这时再从新master同步数据，这会导致old master中的大量数据丢失。</p><p>关于解决的话，我记得在redis的配置中可以设置：第一可以设置最少的salve节点个数，比如设置至少要有一个从节点才能同步数据，第二个可以设置主从数据复制和同步的延迟时间，达不到要求就拒绝请求，就可以避免大量的数据丢失</p><p><strong>面试官</strong>：redis的分片集群有什么作用</p><p><strong>候选人</strong>：分片集群主要解决的是，海量数据存储的问题，集群中有多个master，每个master保存不同数据，并且还可以给每个master设置多个slave节点，就可以继续增大集群的高并发能力。同时每个master之间通过ping监测彼此健康状态，就类似于哨兵模式了。当客户端请求可以访问集群任意节点，最终都会被转发到正确节点</p><p><strong>面试官</strong>：Redis分片集群中数据是怎么存储和读取的？</p><p><strong>候选人</strong>：</p><p>嗯~，在redis集群中是这样的</p><p>Redis 集群引入了哈希槽的概念，有 16384 个哈希槽，集群中每个主节点绑定了一定范围的哈希槽范围， key通过 CRC16 校验后对 16384 取模来决定放置哪个槽，通过槽找到对应的节点进行存储。</p><p>取值的逻辑是一样的</p><p><strong>面试官</strong>：Redis是单线程的，但是为什么还那么快？</p><p><strong>候选人</strong>：</p><p>嗯，这个有几个原因吧~~~</p><p>1、完全基于内存的，C语言编写</p><p>2、采用单线程，避免不必要的上下文切换可竞争条件</p><p>3、使用多路I/O复用模型，非阻塞IO</p><p>例如：bgsave 和 bgrewriteaof 都是在<strong>后台</strong>执行操作，不影响主线程的正常使用，不会产生阻塞</p><p><strong>面试官</strong>：能解释一下I/O多路复用模型？</p><p><strong>候选人</strong>：嗯~~，I/O多路复用是指利用单个线程来同时监听多个Socket ，并在某个Socket可读、可写时得到通知，从而避免无效的等待，充分利用CPU资源。目前的I/O多路复用都是采用的epoll模式实现，它会在通知用户进程Socket就绪的同时，把已就绪的Socket写入用户空间，不需要挨个遍历Socket来判断是否就绪，提升了性能。</p><p>其中Redis的网络模型就是使用I/O多路复用结合事件的处理器来应对多个Socket请求，比如，提供了连接应答处理器、命令回复处理器，命令请求处理器；</p><p>在Redis6.0之后，为了提升更好的性能，在命令回复处理器使用了多线程来处理回复事件，在命令请求处理器中，将命令的转换使用了多线程，增加命令转换速度，在命令执行的时候，依然是单线程</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: zazhang@aliyun.com">zazhang</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a aria-label="Redis分布式锁" class="vp-link nav-link prev nav-link prev" href="/posts/Redis/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81.html"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><span class="font-icon icon fa-fw fa-sm fas fa-pen-to-square" style=""></span>Redis分布式锁</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">TOMMY</div><div class="vp-copyright">Copyright © 2020-2023 tommy</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-7443d472.js" defer></script>
  </body>
</html>
